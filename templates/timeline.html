<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <title>Timeline H·ªçc T·∫≠p (Demo) - StudyVault</title>
    <style>
        /* --- Phong c√°ch chung --- */
        :root { --primary-blue: #0d6efd; --light-bg: #f8f9fa; --white-bg: #ffffff; --card-border-radius: 0.75rem; --element-border-radius: 0.5rem; --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.07); --text-dark: #212529; --text-muted: #6c757d; --green-act-1: #c6e48b; --green-act-2: #7bc96f; --green-act-3: #239a3b; --green-act-4: #196127;}
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--light-bg); color: var(--text-dark); }
        .navbar { background-color: var(--white-bg) !important; box-shadow: var(--card-shadow); }
        .navbar-brand { color: var(--text-dark) !important; font-weight: 600; }
        .navbar-brand i { color: var(--primary-blue); }
        .nav-link { color: #495057 !important; font-weight: 500; }
        .nav-link.active { color: var(--primary-blue) !important; font-weight: 600;}
        .card { border-radius: var(--card-border-radius); border: none; box-shadow: var(--card-shadow); margin-bottom: 1.5rem; background-color: var(--white-bg); border-top: 4px solid var(--primary-blue); }
        .card-header { background-color: transparent; border-bottom: 1px solid #f1f3f5; font-weight: 600; padding: 1rem 1.25rem; color: var(--primary-blue); }
         .card-header i { color: var(--primary-blue) !important; }
        .btn { border-radius: var(--element-border-radius); padding: 0.5rem 1rem; font-weight: 500; }
        .btn-primary { background-color: var(--primary-blue); border-color: var(--primary-blue); }
        .btn-primary:hover { background-color: #0b5ed7; border-color: #0a58ca; }
        .btn-secondary { background-color: #6c757d; border-color: #6c757d; color: white;}
        .btn-secondary:hover { background-color: #5a6268; border-color: #545b62;}
        .form-control, .form-select, .form-check-input { border-radius: var(--element-border-radius); border-color: #dee2e6; }
        .form-control:focus, .form-select:focus { border-color: var(--primary-blue); box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); }
        .form-check-input:checked { background-color: var(--primary-blue); border-color: var(--primary-blue); }
        .badge { border-radius: 50px; font-weight: 500; padding: 0.35em 0.65em; }
        h1 { margin-bottom: 1.5rem !important; font-weight: 600; color: var(--primary-blue); }
         h1 i { color: var(--primary-blue) !important; }
        .list-group-item { border-color: #f1f3f5; padding-top: 0.75rem; padding-bottom: 0.75rem;}

        /* --- CSS L·ªãch Tu·∫ßn (S·ª≠ d·ª•ng Background Xanh L√° - TƒÉng C∆∞·ªùng CSS) --- */
        .timeline-table-container { background-color: var(--white-bg); border-radius: var(--card-border-radius); padding: 15px; box-shadow: var(--card-shadow); }
        .timeline-table { table-layout: fixed; border-collapse: separate; border-spacing: 5px; width: 100%; }
        .timeline-table th { background-color: #e9ecef; color: #495057; border: none; font-weight: 600; text-align: center; height: auto; padding: 0.5rem 0.25rem; font-size: 0.8em; border-radius: var(--element-border-radius); text-transform: uppercase; }
        .timeline-table td {
            border: 1px solid #dee2e6 !important; /* Vi·ªÅn r√µ h∆°n */
            min-height: 100px;
            height: auto !important; /* B·ªè height c·ªë ƒë·ªãnh, ƒë·ªÉ n·ªôi dung quy·∫øt ƒë·ªãnh */
            text-align: left;
            vertical-align: top;
            padding: 8px !important;
            font-size: 0.85em !important;
            position: relative;
            border-radius: var(--element-border-radius) !important;
            word-wrap: break-word !important;
            overflow: hidden !important;
            background-color: #f8f9fa; /* N·ªÅn m·∫∑c ƒë·ªãnh */
            transition: background-color 0.2s ease-in-out;
            border-left: none !important; /* B·ªè border left */
        }

        /* --- M√†u s·∫Øc Ho·∫°t ƒë·ªông v√† Ch·ªØ (Xanh L√° - TƒÉng C∆∞·ªùng CSS) --- */
        .timeline-table td .day-number { color: #212529 !important; font-weight: bold !important; display: block !important; margin-bottom: 4px !important; text-align: right !important; font-size: 1em !important; }
        .timeline-table td .activity-content { font-size: 0.9em !important; line-height: 1.4 !important; color: #212529 !important; }
        .timeline-table td .activity-content .badge { font-size: 0.85em !important; padding: 0.25em 0.4em !important; margin-bottom: 3px !important; }

        .timeline-table td.activity-0 { background-color: #f8f9fa !important; }
        .timeline-table td.activity-0 .day-number, .timeline-table td.activity-0 .activity-content { color: #212529 !important; }
        .timeline-table td.activity-0 .activity-content.text-muted { color: #6c757d !important; }

        .timeline-table td.activity-1 { background-color: var(--green-act-1) !important; }
        .timeline-table td.activity-1 .day-number, .timeline-table td.activity-1 .activity-content { color: #333 !important; } /* Ch·ªØ ƒë·∫≠m h∆°n */
        .timeline-table td.activity-1 .badge { color: #155724 !important; background-color: rgba(255, 255, 255, 0.7) !important; border-color: #c3e6cb !important; }

        .timeline-table td.activity-2 { background-color: var(--green-act-2) !important; }
        .timeline-table td.activity-2 .day-number, .timeline-table td.activity-2 .activity-content { color: #111 !important; } /* Ch·ªØ ƒëen h∆°n */
        .timeline-table td.activity-2 .badge { color: #155724 !important; background-color: rgba(255, 255, 255, 0.75) !important; border-color: #b1dfbb !important; }

        .timeline-table td.activity-3 { background-color: var(--green-act-3) !important; color: white !important; }
        .timeline-table td.activity-3 .day-number, .timeline-table td.activity-3 .activity-content { color: white !important; }
        .timeline-table td.activity-3 .badge { color: #196127 !important; background-color: rgba(255, 255, 255, 0.85) !important; border: none !important;}

        .timeline-table td.activity-4 { background-color: var(--green-act-4) !important; color: white !important; }
        .timeline-table td.activity-4 .day-number, .timeline-table td.activity-4 .activity-content { color: white !important; }
        .timeline-table td.activity-4 .badge { color: #196127 !important; background-color: rgba(255, 255, 255, 0.9) !important; border: none !important; }


        /* --- CSS Ph·∫ßn c√≤n l·∫°i (Stats, AI, Achievements, Monthly) --- */
        .stat-card .card-body { display: flex; align-items: center; justify-content: space-around; }
        .stat-icon { font-size: 2rem; margin-bottom: 0.25rem;}
        .stat-value { font-size: 1.75rem; font-weight: 600; }
        .stat-label { font-size: 0.85rem; color: var(--text-muted); }
        .achievement-badge { padding: 0.4em 0.8em;}
        #aiMascotSection { background-color: var(--white-bg); border-radius: var(--card-border-radius); padding: 1.5rem; text-align: center; border-top: 4px solid var(--primary-blue); }
        #mascotIcon { font-size: 3rem; display: block; margin-bottom: 0.5rem; }
        #mascotMessage { background-color: #e9ecef; border-radius: var(--element-border-radius); padding: 0.8rem 1rem; min-height: 60px; display: flex; align-items: center; justify-content: center; font-style: italic; color: #495057; }
        #aiMoodSelector label { margin-left: 5px; margin-right: 15px; font-size: 0.9em; }

        /* --- CSS L·ªãch Th√°ng (S·ª≠a l·ªói hi·ªÉn th·ªã) --- */
        .monthly-heatmap-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); gap: 1rem; }
        .month-grid { background-color: var(--white-bg); padding: 10px; border-radius: var(--element-border-radius); border: 1px solid #eee;}
        .month-header { font-weight: 500; margin-bottom: 8px; font-size: 0.9rem; text-align: center; color: var(--primary-blue); }
        .month-days-header {
            display: grid !important; /* <<< √âp ki·ªÉu hi·ªÉn th·ªã */
            grid-template-columns: repeat(7, 1fr) !important; /* <<< Chia 7 c·ªôt */
            text-align: center; font-size: 0.65em; color: var(--text-muted); margin-bottom: 4px; padding: 0 2px !important; /* <<< Reset padding */ width: 100% !important; /* <<< ƒê·∫£m b·∫£o full width */
        }
         .month-days-header > div { /* Style cho t·ª´ng ch·ªØ T2, T3... */
             padding: 2px 0;
         }
        .month-days-grid {
            display: grid !important; /* <<< √âp ki·ªÉu hi·ªÉn th·ªã */
            grid-template-columns: repeat(7, 1fr) !important; /* <<< Chia 7 c·ªôt */
            gap: 2px;
        }
        .month-day {
            width: 100%;
            padding-bottom: 100%; /* Gi·ªØ t·ª∑ l·ªá vu√¥ng */
            position: relative;
            border-radius: 3px;
            background-color: #f0f0f0 !important; /* <<< M√†u n·ªÅn √¥ tr·ªëng + important */
            transition: background-color 0.2s ease-in-out;
            border: none;
        }
        /* M√†u cho √¥ th√°ng - D√πng m√†u xanh l√° */
        .month-day.activity-1 { background-color: var(--green-act-1) !important; }
        .month-day.activity-2 { background-color: var(--green-act-2) !important; }
        .month-day.activity-3 { background-color: var(--green-act-3) !important; }
        .month-day.activity-4 { background-color: var(--green-act-4) !important; }

    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white mb-4 sticky-top">
        <div class="container"> <a class="navbar-brand fw-bold" href="{{ url_for('index') }}"><i class="bi bi-book-half text-primary"></i> StudyVault</a> <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav ms-auto"> <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Dashboard</a></li> <li class="nav-item"><a class="nav-link" href="{{ url_for('upload_file') }}">T·∫£i l√™n</a></li> <li class="nav-item"><a class="nav-link active" aria-current="page" href="{{ url_for('study_timeline') }}">Timeline</a></li> <li class="nav-item"><a class="nav-link" href="{{ url_for('lazy_market') }}">LazyMarket & C·ªông ƒë·ªìng</a></li> </ul> </div> </div>
    </nav>

    <div class="container mt-4">
        <h1 class="mb-4 fw-bold"><i class="bi bi-calendar-check text-primary"></i> D√≤ng th·ªùi gian & Hi·ªáu su·∫•t h·ªçc t·∫≠p</h1>
        <div class="row">
            <div class="col-lg-5">
                 <div class="card" id="aiMascotSection"> <span id="mascotIcon">ü¶â</span> <div id="mascotMessage" class="alert alert-info">Ch√†o b·∫°n! C√πng xem ti·∫øn ƒë·ªô h·ªçc t·∫≠p h√¥m nay nh√©!</div> <div class="mt-3" id="aiMoodSelector"> <span class="me-2 small text-muted">T√¢m tr·∫°ng C√∫:</span> <div class="form-check form-check-inline"> <input class="form-check-input" type="radio" name="aiMood" id="moodFriendly" value="friendly" checked> <label class="form-check-label" for="moodFriendly">Th√¢n thi·ªán</label> </div> <div class="form-check form-check-inline"> <input class="form-check-input" type="radio" name="aiMood" id="moodStrict" value="strict"> <label class="form-check-label" for="moodStrict">Nghi√™m kh·∫Øc</label> </div> <div class="form-check form-check-inline"> <input class="form-check-input" type="radio" name="aiMood" id="moodSad" value="sad"> <label class="form-check-label" for="moodSad">·ª¶ r≈©</label> </div> </div> </div>
                 <div class="card stat-card"> <div class="card-header"><i class="bi bi-bar-chart-line-fill"></i> Hi·ªáu su·∫•t Tu·∫ßn N√†y (Demo)</div> <div class="card-body"> <div class="text-center"> <i class="bi bi-fire stat-icon text-danger"></i> <div class="stat-value">{{ current_streak }}</div> <div class="stat-label">Ng√†y Streak</div> </div> <div class="text-center"> <i class="bi bi-check2-square stat-icon text-success"></i> <div class="stat-value">{{ docs_viewed_today }}</div> <div class="stat-label">Xem h√¥m nay</div> </div> <div class="text-center"> <i class="bi bi-clock-history stat-icon text-info"></i> <div class="stat-value">{{ avg_session_minutes }}<small>p</small></div> <div class="stat-label">TB / l·∫ßn h·ªçc</div> </div> </div> <div class="card-footer text-muted small"> T·ªïng t√†i li·ªáu ƒë√£ t√≥m t·∫Øt: {{ total_docs_summarized }} </div> </div>
                 <div class="card"> <div class="card-header"><i class="bi bi-calendar-check-fill"></i> H√†ng ƒë·ª£i √în t·∫≠p (Demo)</div> <ul class="list-group list-group-flush"> {% if review_items %} {% for item in review_items %} <li class="list-group-item d-flex justify-content-between align-items-center"> <a href="{{ url_for('view_document', document_id=item.id) if item.id else '#' }}" class="text-decoration-none text-dark" title="{{ item.name }}"><i class="bi bi-file-earmark-text me-2"></i>{{ item.name | truncate(35) }}</a> <span class="badge bg-warning text-dark rounded-pill">{{ item.due }}</span> </li> {% endfor %} {% else %} <li class="list-group-item text-muted">Kh√¥ng c√≥ t√†i li·ªáu n√†o c·∫ßn √¥n t·∫≠p ngay.</li> {% endif %} </ul> </div>
                 <div class="card"> <div class="card-header"><i class="bi bi-award-fill"></i> Th√†nh T·ª±u ƒê·∫°t ƒê∆∞·ª£c (Demo)</div> <div class="card-body"> <div id="achievementsList"> {% for ach in earned_achievements %} <span class="achievement-badge"> <i class="bi {{ ach.icon }}"></i> {{ ach.text }} </span> {% else %} <p class="text-muted">H√£y b·∫Øt ƒë·∫ßu h·ªçc ƒë·ªÉ m·ªü kh√≥a th√†nh t·ª±u nh√©!</p> {% endfor %} </div> <hr> <button id="shareAchievementsBtn" class="btn btn-primary w-100"> <i class="bi bi-share-fill"></i> C·∫≠p nh·∫≠t ƒêi·ªÉm v√†o BXH </button> </div> </div>
            </div>

            <div class="col-lg-7">
                 <div class="card">
                    <div class="card-header"><i class="bi bi-calendar-week"></i> Ho·∫°t ƒë·ªông Tu·∫ßn N√†y (Ng·∫´u nhi√™n)</div>
                    <div class="card-body p-3">
                         <div class="d-flex align-items-center mb-3 justify-content-center small text-muted">
                            <span class="me-1">√çt</span>
                            <span class="me-1" style="width:15px; height:15px; background-color: #f8f9fa !important; border: 1px solid #ccc;">&nbsp;</span>
                            <span class="me-1" style="width:15px; height:15px; background-color: var(--green-act-1) !important; border-radius: 3px;"></span>
                            <span class="me-1" style="width:15px; height:15px; background-color: var(--green-act-2) !important; border-radius: 3px;"></span>
                            <span class="me-1" style="width:15px; height:15px; background-color: var(--green-act-3) !important; border-radius: 3px;"></span>
                            <span class="me-1" style="width:15px; height:15px; background-color: var(--green-act-4) !important; border-radius: 3px;"></span>
                            <span class="ms-1">Nhi·ªÅu</span>
                         </div>
                         <div class="timeline-table-container bg-transparent p-0 shadow-none border-0">
                            <table class="timeline-table w-100" id="weeklyTimelineTable">
                                <thead> <tr> <th>Hai</th> <th>Ba</th> <th>T∆∞</th> <th>NƒÉm</th> <th>S√°u</th> <th>B·∫£y</th> <th>CN</th> </tr> </thead>
                                <tbody> <tr> <td></td><td></td><td></td><td></td><td></td><td></td><td></td> </tr> </tbody>
                            </table>
                        </div>
                        <p class="text-center small text-muted mt-3">**D·ªØ li·ªáu ho·∫°t ƒë·ªông tu·∫ßn n√†y ƒë∆∞·ª£c t·∫°o ng·∫´u nhi√™n.**</p>
                    </div>
                 </div>

                 <div class="card">
                     <div class="card-header"><i class="bi bi-calendar-month"></i> Ho·∫°t ƒë·ªông theo Th√°ng (Demo Ng·∫´u nhi√™n)</div>
                     <div class="card-body">
                         <p class="text-muted small">Hi·ªÉn th·ªã m·ª©c ƒë·ªô ho·∫°t ƒë·ªông gi·∫£ l·∫≠p trong c√°c th√°ng qua. M√†u √¥ vu√¥ng th·ªÉ hi·ªán m·ª©c ƒë·ªô.</p>
                         <div class="d-flex align-items-center mb-3 justify-content-center small text-muted">
                             <span class="me-1">√çt</span>
                             <span class="badge me-1" style="width:15px; height:15px; background-color: #f8f9fa !important; border: 1px solid #ccc;">&nbsp;</span>
                             <span class="badge me-1" style="width:15px; height:15px; background-color: var(--green-act-1) !important;">&nbsp;</span>
                             <span class="badge me-1" style="width:15px; height:15px; background-color: var(--green-act-2) !important;">&nbsp;</span>
                             <span class="badge me-1" style="width:15px; height:15px; background-color: var(--green-act-3) !important;">&nbsp;</span>
                             <span class="badge me-1" style="width:15px; height:15px; background-color: var(--green-act-4) !important;">&nbsp;</span>
                             <span class="ms-1">Nhi·ªÅu</span>
                          </div>
                         <div id="monthlyActivitySection" class="monthly-heatmap-container">
                             </div>
                     </div>
                 </div>

            </div> </div> <div class="mt-4 mb-5 text-center"> <a href="{{ url_for('index') }}" class="btn btn-secondary"><i class="bi bi-arrow-left-circle"></i> Quay l·∫°i Dashboard</a> </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
         // --- L·∫•y d·ªØ li·ªáu th√†nh t·ª±u t·ª´ Flask ƒë·ªÉ JS s·ª≠ d·ª•ng ---
         const earnedAchievementsData = {{ earned_achievements | tojson | safe }};

         // --- H√ÄM SHARE ACHIEVEMENTS ---
         function shareAchievements() { console.log("shareAchievements called!"); const achievementsContainer = document.getElementById('achievementsList'); const achievementsCount = achievementsContainer ? achievementsContainer.querySelectorAll('.achievement-badge').length : (Array.isArray(earnedAchievementsData) ? earnedAchievementsData.length : 0); console.log("Achievements count:", achievementsCount); const baseScore = achievementsCount * 4000; const bonusScore = Math.floor(Math.random() * 151) + 50; const totalScore = baseScore + bonusScore; console.log(`Calculated score: ${totalScore} (Base: ${baseScore}, Bonus: ${bonusScore})`); if (typeof(Storage) !== "undefined") { localStorage.setItem('myTimelineScore', totalScore); console.log(`Timeline score saved to localStorage: ${totalScore}`); window.location.href = "/lazymarket#ranking-tab"; } else { console.error("LocalStorage is not supported!"); alert("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ l∆∞u tr·ªØ c·ª•c b·ªô, kh√¥ng th·ªÉ c·∫≠p nh·∫≠t ƒëi·ªÉm."); } }

         // --- ƒê·ªäNH NGHƒ®A L·ªúI THO·∫†I ---
         const mascotDialogues = { friendly: { streak: ["Tuy·ªát v·ªùi! B·∫°n ƒë√£ gi·ªØ v·ªØng {N} ng√†y streak! C·ªë l√™n!", "Chu·ªói {N} ng√†y r·ªìi! B·∫°n ƒëang l√†m r·∫•t t·ªët!", "Wow, {N} ng√†y li√™n t·ª•c! Gi·ªØ v·ªØng phong ƒë·ªô nh√©!", "Ti·∫øp t·ª•c ph√°t huy! Streak {N} ng√†y th·∫≠t ·∫•n t∆∞·ª£ng!", "ƒê√† n√†y c·ª© gi·ªØ nh√©, {N} ng√†y streak r·ªìi!", "B·∫°n th·∫≠t ki√™n tr√¨! {N} ng√†y r·ªìi ƒë·∫•y!", "C√∫ r·∫•t vui v√¨ b·∫°n chƒÉm ch·ªâ {N} ng√†y qua!", "M·ªói ng√†y m·ªôt b∆∞·ªõc, {N} ng√†y th·∫≠t ƒë√°ng n·ªÉ!", "ƒê·ª´ng qu√™n t·ª± th∆∞·ªüng cho m√¨nh sau {N} ng√†y c·ªë g·∫Øng nha!", "H√†nh tr√¨nh {N} ng√†y c·ªßa b·∫°n th·∫≠t truy·ªÅn c·∫£m h·ª©ng!"], no_streak: ["Kh√¥ng sao c·∫£! B·∫Øt ƒë·∫ßu l·∫°i chu·ªói streak m·ªõi ngay h√¥m nay n√†o!", "M·ªói ng√†y m·ªõi l√† m·ªôt c∆° h·ªôi m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu!", "ƒê·ª´ng n·∫£n l√≤ng, h√¥m nay l√† ng√†y tuy·ªát v·ªùi ƒë·ªÉ h·ªçc!", "C√∫ tin b·∫°n s·∫Ω s·ªõm c√≥ l·∫°i streak th√¥i!", "H√£y bi·∫øn h√¥m nay th√†nh ng√†y ƒë·∫ßu ti√™n c·ªßa chu·ªói m·ªõi!", "B·∫Øt ƒë·∫ßu l·∫°i th√¥i, kh√¥ng c√≥ g√¨ l√† qu√° mu·ªôn!", "M·ªôt ch√∫t gi√°n ƒëo·∫°n kh√¥ng sao, quan tr·ªçng l√† ti·∫øp t·ª•c!", "C√∫ lu√¥n ·ªü ƒë√¢y c·ªï v≈© b·∫°n l·∫•y l·∫°i phong ƒë·ªô!", "H√¥m nay c·ªë g·∫Øng nh√©, ng√†y mai s·∫Ω t·ªët h∆°n!", "S·∫µn s√†ng cho m·ªôt kh·ªüi ƒë·∫ßu m·ªõi ch∆∞a n√†o?"] }, strict: { streak: ["Streak: {N} ng√†y. T·ªët. ƒê·ª´ng d·ª´ng l·∫°i.", "{N} ng√†y. Duy tr√¨ k·ª∑ lu·∫≠t l√† ch√¨a kh√≥a.", "Ti·∫øp t·ª•c. M·ª•c ti√™u c√≤n ·ªü ph√≠a tr∆∞·ªõc. ({N} ng√†y)", "ƒê·ª´ng l∆° l√†. Streak {N} ng√†y c·∫ßn ƒë∆∞·ª£c b·∫£o v·ªá.", "{N} ng√†y r·ªìi. ƒê·∫£m b·∫£o ho√†n th√†nh nhi·ªám v·ª• h√¥m nay.", "S·ª± nh·∫•t qu√°n t·∫°o n√™n k·∫øt qu·∫£. ({N} ng√†y)", "Ghi nh·∫≠n: {N} ng√†y. Y√™u c·∫ßu ti·∫øp t·ª•c.", "Kh√¥ng c√≥ th·ªùi gian ngh·ªâ ng∆°i. {N} ng√†y streak.", "T·∫≠p trung. {N} ng√†y ch·ªâ l√† kh·ªüi ƒë·∫ßu.", "Ti·∫øn ƒë·ªô: {N} ng√†y. Ph·∫£i duy tr√¨."], no_streak: ["Streak ƒë√£ m·∫•t! T·∫≠p trung l·∫°i ngay! Kh√¥ng ƒë∆∞·ª£c l∆∞·ªùi bi·∫øng!", "Th·∫•t b·∫°i trong vi·ªác duy tr√¨ streak. C·∫ßn nghi√™m t√∫c h∆°n!", "T·∫°i sao l·∫°i d·ª´ng? B·∫Øt ƒë·∫ßu l·∫°i ngay l·∫≠p t·ª©c!", "Kh√¥ng c√≥ l√Ω do g√¨ cho s·ª± gi√°n ƒëo·∫°n. H·ªçc ƒëi!", "H·∫≠u qu·∫£ c·ªßa vi·ªác l∆° l√†: m·∫•t streak. Ph·∫£i kh·∫Øc ph·ª•c!", "ƒê·ª´ng ƒë·ªÉ vi·ªác n√†y l·∫∑p l·∫°i. B·∫Øt ƒë·∫ßu l·∫°i ngay!", "Th·ªùi gian l√† v√†ng b·∫°c. ƒê·ª´ng l√£ng ph√≠ th√™m!", "Y√™u c·∫ßu quay l·∫°i gu·ªìng h·ªçc t·∫≠p ngay!", "K·ª∑ lu·∫≠t ƒë√¢u r·ªìi? L·∫•y l·∫°i streak ngay!", "C∆° h·ªôi ƒë√£ m·∫•t. Ph·∫£i n·ªó l·ª±c g·∫•p ƒë√¥i!"] }, sad: { streak: ["Streak {N} ng√†y r·ªìi! ƒê·ª´ng l√†m C√∫ bu·ªìn nha...", "B·∫°n v·∫´n ƒëang c·ªë g·∫Øng ({N} ng√†y), C√∫ ƒë·ª° bu·ªìn h∆°n ch√∫t...", "Nh·ªõ duy tr√¨ nh√©, C√∫ kh√¥ng mu·ªën m·∫•t streak n√†y ƒë√¢u... ({N} ng√†y)", "C√∫ h∆°i lo l·∫Øng... nh∆∞ng b·∫°n v·∫´n c√≤n streak {N} ng√†y.", "({N} ng√†y) ... Li·ªáu b·∫°n c√≥ gi·ªØ ƒë∆∞·ª£c kh√¥ng?", "Hy v·ªçng ng√†y mai v·∫´n th·∫•y streak {N+1}...", "ƒê·ª´ng b·ªè r∆°i C√∫ v√† streak {N} ng√†y nha...", "C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©... ({N} ng√†y)", "C√∫ s·∫Ω vui h∆°n n·∫øu b·∫°n gi·ªØ ƒë∆∞·ª£c streak d√†i h∆°n... ({N} ng√†y)", "Ch·ªâ c·∫ßn ƒë·ª´ng d·ª´ng l·∫°i l√† ƒë∆∞·ª£c... ({N} ng√†y)"], no_streak: ["√îi kh√¥ng... streak m·∫•t r·ªìi... C√∫ bu·ªìn l·∫Øm...", "T·∫°i sao l·∫°i nh∆∞ v·∫≠y ch·ª©... C√∫ r·∫•t th·∫•t v·ªçng...", "Bu·ªìn qu√°... kh√¥ng c√≤n th·∫•y streak n·ªØa...", "Gi√° nh∆∞ b·∫°n c·ªë th√™m ch√∫t n·ªØa...", "C√∫ kh√¥ng bi·∫øt n√≥i g√¨ h∆°n... th·∫≠t ƒë√°ng ti·∫øc...", "C√≥ l·∫Ω h√¥m nay b·∫°n kh√¥ng vui... C√∫ c≈©ng v·∫≠y...", "M·∫•t streak r·ªìi... c·∫£m gi√°c th·∫≠t t·ªá...", "Hy v·ªçng b·∫°n s·∫Ω s·ªõm vui v·∫ª v√† h·ªçc l·∫°i...", "C√∫ nh·ªõ nh·ªØng ng√†y c√≥ streak...", "Th√¥i th√¨... ng√†y mai c·ªë g·∫Øng nh√©..."] } };

        document.addEventListener('DOMContentLoaded', function() {
           // --- Script AI Mascot ---
           const moodSelectors = document.querySelectorAll('input[name="aiMood"]'); const mascotIcon = document.getElementById('mascotIcon'); const mascotMessage = document.getElementById('mascotMessage'); const currentStreak = typeof {{ current_streak | default(0) }} !== 'undefined' ? {{ current_streak | default(0) }} : 0; function updateMascot() { const selectedMoodInput = document.querySelector('input[name="aiMood"]:checked'); if (!selectedMoodInput) return; const selectedMood = selectedMoodInput.value; let icon = 'ü¶â'; let message = ''; let alertClass = 'alert-info'; const streakStatus = currentStreak > 0 ? 'streak' : 'no_streak'; const dialoguesForMood = mascotDialogues[selectedMood]; if (!dialoguesForMood) { console.error("Invalid mood selected:", selectedMood); return; } const possibleMessages = dialoguesForMood[streakStatus]; if (possibleMessages && possibleMessages.length > 0) { message = possibleMessages[Math.floor(Math.random() * possibleMessages.length)]; message = message.replace('{N}', currentStreak); message = message.replace('{N+1}', currentStreak + 1); } else { message = "C√∫ ƒëang kh√¥ng bi·∫øt n√≥i g√¨..."; } if (streakStatus === 'streak') { if (selectedMood === 'friendly') { icon = 'ü•≥'; alertClass = 'alert-success'; } else if (selectedMood === 'strict') { icon = 'üßê'; alertClass = 'alert-warning'; } else { icon = 'ü•∫'; alertClass = 'alert-primary'; } } else { if (selectedMood === 'friendly') { icon = 'üí™'; alertClass = 'alert-info'; } else if (selectedMood === 'strict') { icon = 'üò†'; alertClass = 'alert-danger'; } else { icon = 'üò¢'; alertClass = 'alert-secondary'; } } if (mascotIcon) mascotIcon.textContent = icon; if (mascotMessage) { mascotMessage.textContent = message; mascotMessage.className = 'alert ' + alertClass; mascotMessage.id = 'mascotMessage'; } } if (moodSelectors.length > 0) { moodSelectors.forEach(radio => { radio.addEventListener('change', updateMascot); }); updateMascot(); }

            // --- Script Randomize L·ªãch Tu·∫ßn (D√πng Background Xanh L√°) ---
            function randomizeWeeklyTimeline() { const weeklyTableBody = document.querySelector("#weeklyTimelineTable tbody"); if (!weeklyTableBody) { console.error("Weekly timeline table body not found!"); return; } const row = weeklyTableBody.querySelector('tr'); if (!row) { console.error("Weekly timeline table row not found!"); return; } row.innerHTML = ''; const sampleActivities = [ "ƒê·ªçc t√†i li·ªáu", "Xem video b√†i gi·∫£ng", "T√≥m t·∫Øt ch∆∞∆°ng", "L√†m Quiz √¥n t·∫≠p", "T√¨m hi·ªÉu Link tham kh·∫£o", "√în t·∫≠p Flashcards", "(Ngh·ªâ ng∆°i)", "Gi·∫£i b√†i t·∫≠p", "Vi·∫øt Code Demo", "Th·ª±c h√†nh Lab", "Nghi√™n c·ª©u Case Study", "Th·∫£o lu·∫≠n nh√≥m", "Chu·∫©n b·ªã thuy·∫øt tr√¨nh", "Ghi ch√∫ √Ω ch√≠nh", "Nghe Podcast h·ªçc thu·∫≠t", "ƒê·ªçc b√°o c√°o", "Ph√¢n t√≠ch d·ªØ li·ªáu", "Vi·∫øt lu·∫≠n", "S·ª≠a b√†i vi·∫øt", "Brainstorm √Ω t∆∞·ªüng", "L·∫≠p d√†n √Ω", "H·ªçc t·ª´ v·ª±ng m·ªõi", "Luy·ªán nghe h·ªôi tho·∫°i", "T·∫≠p vi·∫øt ƒëo·∫°n vƒÉn", "Luy·ªán ph√°t √¢m", "D·ªãch t√†i li·ªáu", "T√¨m ki·∫øm th√¥ng tin", "So·∫°n slide", "Xem l·∫°i ghi ch√∫ c≈©", "Th·ª≠ gi·∫£i th√≠ch l·∫°i kh√°i ni·ªám", "Tham gia Webinar", "ƒê·ªçc s√°ch chuy√™n kh·∫£o", "H·ªçc c√¥ng th·ª©c", "Ch·ª©ng minh ƒë·ªãnh l√Ω", "V·∫Ω s∆° ƒë·ªì t∆∞ duy", "L·∫≠p k·∫ø ho·∫°ch h·ªçc t·∫≠p", "Xem phim t√†i li·ªáu", "Th·ª±c h√†nh k·ªπ nƒÉng m·ªÅm", "T√¨m l·ªói code", "Review code b·∫°n", "(Gi·∫£i lao ng·∫Øn)", "Code LeetCode", "ƒê·ªçc s√°ch ti·∫øng Anh" ]; const sampleTags = [ "Python", "Kinh t·∫ø", "Gi·∫£i t√≠ch", "IELTS", "Thuy·∫øt tr√¨nh", "Web",  "Th·ªëng k√™", "Ti·∫øng Nh·∫≠t", "Khoa h·ªçc", "Java", "T√†i ch√≠nh", "ƒê·∫°i s·ªë", "Ti·∫øng Ph√°p", "App Mobile", "Data Science",  "V·∫≠t l√Ω", "Ti·∫øng Trung",  "ƒê·ªì √°n", "Thu·∫≠t to√°n", "K·∫ø to√°n", "H√¨nh h·ªçc", "Ng·ªØ ph√°p", "UI/UX", "Seminar",  "ƒêi·ªán t·ª≠",  "L·ªãch s·ª≠",  "Vi·∫øt Email", "D·ª± √°n",  "Blockchain", "Network", "Tri·∫øt h·ªçc" ]; const today = new Date(); const currentDayOfWeek = (today.getDay() + 6) % 7; for (let index = 0; index < 7; index++) { const cell = document.createElement('td'); let activityLevel = Math.floor(Math.random() * 5); if (index >= 5 && Math.random() < 0.4) { activityLevel = 0; } cell.className = 'activity-' + activityLevel; const dayNumberSpan = document.createElement('span'); dayNumberSpan.className = 'day-number'; const activityContentDiv = document.createElement('div'); activityContentDiv.className = 'activity-content'; let contentHTML = ''; let dayNumber = '??'; const dayDiff = index - currentDayOfWeek; const cellDate = new Date(today); cellDate.setDate(today.getDate() + dayDiff); dayNumber = cellDate.getDate(); dayNumberSpan.textContent = dayNumber; if (activityLevel === 0) { contentHTML = '(Ngh·ªâ)'; activityContentDiv.classList.add('text-muted'); } else { activityContentDiv.classList.remove('text-muted'); let activity1 = sampleActivities[Math.floor(Math.random() * sampleActivities.length)]; while (activity1 === '(Ngh·ªâ ng∆°i)' || activity1 === '(Gi·∫£i lao ng·∫Øn)') { activity1 = sampleActivities[Math.floor(Math.random() * sampleActivities.length)]; } contentHTML = activity1; let hasTag = false; if (activityLevel >= 2 && Math.random() < 0.6) { contentHTML = `<span class="badge bg-primary-subtle text-primary-emphasis rounded-pill">${sampleTags[Math.floor(Math.random() * sampleTags.length)]}</span><br>` + contentHTML; hasTag = true; } if (activityLevel >= 3 && Math.random() < (hasTag ? 0.3 : 0.6)) { let activity2 = sampleActivities[Math.floor(Math.random() * sampleActivities.length)]; while (activity2 === activity1 || activity2 === '(Ngh·ªâ ng∆°i)' || activity2 === '(Gi·∫£i lao ng·∫Øn)') { activity2 = sampleActivities[Math.floor(Math.random() * sampleActivities.length)]; } contentHTML += `<br>${activity2}`; } } activityContentDiv.innerHTML = contentHTML; cell.appendChild(dayNumberSpan); cell.appendChild(activityContentDiv); row.appendChild(cell); } }
            randomizeWeeklyTimeline();

            // Script T·∫°o L·ªãch Th√°ng (Li√™n ti·∫øp - ƒê√£ s·ª≠a CSS v√† ki·ªÉm tra JS)
            function generateMonthlyHeatmaps(containerId, numMonthsToShow) {
                const container = document.getElementById(containerId);
                if (!container) { console.error("Monthly heatmap container not found!", containerId); return; }
                container.innerHTML = ''; // Clear previous content
                console.log("Attempting to generate monthly heatmaps..."); // Log start

                const today = new Date();
                const monthNames = ["Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6", "Th√°ng 7", "Th√°ng 8", "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"];
                const dayShortNames = ["T2", "T3", "T4", "T5", "T6", "T7", "CN"];
                const totalLookbackRange = 12;
                const randomStartOffset = Math.floor(Math.random() * (totalLookbackRange - numMonthsToShow + 1)) - (totalLookbackRange - 1);
                let selectedMonths = [];

                for (let i = 0; i < numMonthsToShow; i++) {
                    const targetDate = new Date(today.getFullYear(), today.getMonth() + randomStartOffset + i, 1);
                    selectedMonths.push({ year: targetDate.getFullYear(), month: targetDate.getMonth() });
                }
                console.log("Selected months:", selectedMonths); // Log th√°ng ƒë√£ ch·ªçn

                selectedMonths.forEach(monthInfo => {
                    const year = monthInfo.year;
                    const month = monthInfo.month; // 0-11
                    const firstDayOfMonth = new Date(year, month, 1);
                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    let startingDay = (firstDayOfMonth.getDay() + 6) % 7; // 0=Mon, 6=Sun

                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'month-grid'; // Class cho style card c·ªßa th√°ng

                    const monthHeader = document.createElement('div');
                    monthHeader.className = 'month-header'; // Class cho ti√™u ƒë·ªÅ th√°ng
                    monthHeader.textContent = `${monthNames[month]} ${year}`;
                    monthDiv.appendChild(monthHeader);

                    const daysHeaderDiv = document.createElement('div');
                    daysHeaderDiv.className = 'month-days-header'; // Class cho header ng√†y (T2,T3..)
                    dayShortNames.forEach(dayName => {
                         const dayHeader = document.createElement('div');
                         dayHeader.textContent = dayName;
                         daysHeaderDiv.appendChild(dayHeader);
                    });
                    monthDiv.appendChild(daysHeaderDiv);

                    const daysGridDiv = document.createElement('div');
                    daysGridDiv.className = 'month-days-grid'; // Class cho l∆∞·ªõi ch·ª©a c√°c √¥ ng√†y
                    console.log(`Generating grid for ${monthNames[month]} ${year}. Days: ${daysInMonth}, Start Day Index: ${startingDay}`); // Log th√¥ng tin th√°ng

                    // Th√™m √¥ tr·ªëng ƒë·∫ßu th√°ng
                    for (let j = 0; j < startingDay; j++) {
                        const emptyCell = document.createElement('div');
                        emptyCell.className = 'month-day';
                        daysGridDiv.appendChild(emptyCell);
                    }

                    // Th√™m √¥ ng√†y c√≥ m√†u
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dayCell = document.createElement('div');
                        const activityLevel = Math.floor(Math.random() * 5); // Random 0-4
                        dayCell.className = `month-day activity-${activityLevel}`; // <<< G√ÅN L·ªöP activity-*
                        dayCell.title = `${day}/${month + 1}/${year} - M·ª©c ${activityLevel}`;
                        // console.log(`Day ${day}: Level ${activityLevel}, Class: ${dayCell.className}`); // Log chi ti·∫øt t·ª´ng √¥ (c√≥ th·ªÉ b·∫≠t n·∫øu c·∫ßn debug s√¢u)
                        daysGridDiv.appendChild(dayCell);
                    }

                    monthDiv.appendChild(daysGridDiv); // Th√™m l∆∞·ªõi ng√†y v√†o div th√°ng
                    container.appendChild(monthDiv); // Th√™m div th√°ng v√†o container ch√≠nh
                });
                console.log("Monthly heatmaps generation complete."); // Log k·∫øt th√∫c
            }
            // ƒê·∫£m b·∫£o container t·ªìn t·∫°i tr∆∞·ªõc khi g·ªçi h√†m
            if (document.getElementById('monthlyActivitySection')) {
                 generateMonthlyHeatmaps('monthlyActivitySection', 4);
            } else {
                 console.error("Container #monthlyActivitySection not found! Cannot generate monthly heatmaps.");
            }


            // G·∫Øn s·ª± ki·ªán cho n√∫t Share Achievements b·∫±ng ID
            const shareBtn = document.getElementById('shareAchievementsBtn');
            if (shareBtn) {
                shareBtn.addEventListener('click', shareAchievements);
                console.log("Event listener added to shareAchievementsBtn");
            } else {
                console.error("Could not find shareAchievementsBtn!");
            }

        });
    </script>
</body>
</html>